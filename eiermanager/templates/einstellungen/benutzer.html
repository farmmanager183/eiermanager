{% extends "base.html" %}
{% block title %}Einstellungen – Benutzer{% endblock %}
{% block content %}
<div class="fm-card card p-3">
  <h3 class="mb-3 text-center">Benutzer verwalten</h3>

  <form class="mx-auto mb-3" style="max-width:540px;" method="post" action="{{ url_for('einstellungen.user_add') }}">
    <div class="row g-2">
      <div class="col-12 col-md-5"><input class="form-control" name="username" placeholder="Benutzername" required></div>
      <div class="col-7 col-md-5"><input class="form-control" name="pin" placeholder="4-stellige PIN" pattern="\\d{4}" required></div>
      <div class="col-5 col-md-2 d-grid"><button class="btn btn-primary">Anlegen</button></div>
    </div>
    <div class="form-check mt-2 text-center">
      <input class="form-check-input" type="checkbox" value="1" id="is_admin" name="is_admin">
      <label class="form-check-label" for="is_admin">Admin</label>
    </div>
  </form>

  <div class="table-responsive mx-auto" style="max-width:860px;">
    <table class="table table-sm align-middle">
      <thead><tr><th>Benutzer</th><th>Admin</th><th class="text-end">Aktionen</th></tr></thead>
      <tbody>
      {% for u in users %}
      <tr>
        <td>{{ u.username }}</td>
        <td>{{ 'Ja' if u.is_admin else 'Nein' }}</td>
        <td class="text-end">
          <form method="post" action="{{ url_for('einstellungen.user_reset_pin', user_id=u.id) }}" class="d-inline">
            <button class="btn btn-outline-secondary btn-sm">PIN ändern</button>
          </form>
          <form method="post" action="{{ url_for('einstellungen.user_delete', user_id=u.id) }}"
                class="d-inline" onsubmit="return confirm('Diesen Benutzer löschen?');">
            <button class="btn btn-outline-danger btn-sm">Löschen</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="3" class="text-center text-muted">Noch keine Benutzer.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="d-flex justify-content-center mt-3">
    <a href="{{ url_for('einstellungen.index') }}" class="btn btn-outline-secondary">Zurück</a>
  </div>
</div>
{% endblock %}
