{% extends "base.html" %}
{% block title %}Heutige Abos{% endblock %}
{% block content %}
<div class="fm-card fm-menu">
    <div class="fm-header">
        <img src="{{ url_for('static', filename='images/FarmManager_Logo.png') }}" class="fm-logo" onerror="this.style.display='none'">
        <h1 class="fm-hello">Heutige Abos ({{ today.strftime('%d.%m.%Y') }})</h1>
        <a href="{{ url_for('eier.menu') }}" class="fm-settings" title="Zurück">⬅️</a>
    </div>

    {% if abos %}
    <div class="abg-grid">
        {% for a in abos %}
        {% set ex = ex_by_abo.get(a.id) %}
        <div class="grid-item{% if ex %} is-active{% endif %}">
            <div class="fm-txt" style="font-weight:800; text-align:center;">{{ a.kunde }}</div>
            <div class="fm-subtle" style="margin-top:2px;">Abo: {{ a.menge }} Eier</div>

            {% if ex and ex.action == 'skip' %}
            <div class="badge-soft" style="margin-top:8px;">❌ Diese Woche ausgesetzt</div>
            {% elif ex and ex.action == 'shift' %}
            <div class="badge-soft" style="margin-top:8px;">↪️ verschoben auf {{ ex.new_datum.strftime('%d.%m.%Y') }}</div>
            {% endif %}

            <form method="POST" class="fm-actions" style="margin-top:12px;">
                <input type="hidden" name="abo_id" value="{{ a.id }}">
                <button class="btn btn-green" name="action" value="book_today" {% if ex %}disabled{% endif %}>Heute buchen</button>
                <button class="btn btn-outline" name="action" value="book_tomorrow" {% if ex %}disabled{% endif %}>Morgen vormerken</button>
                <button class="btn btn-red" name="action" value="skip_week" {% if ex %}disabled{% endif %}>Woche aussetzen</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-muted">Heute sind keine aktiven Abos geplant.</div>
    {% endif %}

    <div class="fm-actions">
        <a href="{{ url_for('eier.menu') }}" class="btn btn-outline">⬅️ Zurück</a>
    </div>
</div>
{% endblock %}
