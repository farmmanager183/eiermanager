{% extends "base.html" %}
{% block title %}HÃ¼hner â€“ Ãœbersicht{% endblock %}

{% block content %}
<div class="fm-card fm-menu">
  <div class="fm-header">
    <img src="{{ url_for('static', filename='images/FarmManager_Logo.png') }}" alt="Logo" class="fm-logo" onerror="this.style.display='none'">
    <h1 class="fm-hello">Ãœbersicht MobilstÃ¤lle</h1>
    <!-- FIX: richtiger Endpoint -->
    <a href="{{ url_for('einstellungen.stalle_list') }}" class="fm-settings" title="StartbestÃ¤nde pflegen">âš™ï¸</a>
  </div>

  {% if cards %}
  <div class="fm-grid" style="margin-top:8px;">
    {% for c in cards %}
    <a class="fm-tile fm-stallcard" href="{{ url_for('huehner.stall', stall_id=c.stall.id) }}">
      <!-- Titel -->
      <div class="stall-head">
        <div class="stall-name">ğŸ“ {{ c.stall.name }}</div>
        {% if c.hens is not none %}
        <span class="badge-soft">Bestand: {{ c.hens }}</span>
        {% else %}
        <span class="badge-soft badge-muted">Bestand: â€“</span>
        {% endif %}
      </div>

      <!-- KPIs -->
      <div class="kpi-row">
        <div class="kpi">
          <div class="kpi-value">{{ c.eggs7 }}</div>
          <div class="kpi-label">Eier / 7 Tage</div>
        </div>
        <div class="kpi">
          <div class="kpi-value">{% if c.rate is not none %}{{ c.rate }}%{% else %}â€“{% endif %}</div>
          <div class="kpi-label">Legeleistung</div>
        </div>
        <div class="kpi">
          <div class="kpi-value">
            {% if c.last_feed[0] %}{{ c.last_feed[0] }}{% else %}â€“{% endif %}
          </div>
          <div class="kpi-label">letzte FÃ¼tterung</div>
        </div>
      </div>

      <!-- Letzte Aktionen -->
      <div class="meta-row">
        <span class="chip">
          ğŸ’§ <span class="chip-text">{% if c.last_water[0] %}{{ c.last_water[0] }}{% else %}â€“{% endif %}</span>
        </span>
        <span class="chip">
          ğŸ§¹ <span class="chip-text">{% if c.last_clean[0] %}{{ c.last_clean[0] }}{% else %}â€“{% endif %}</span>
        </span>
        <span class="chip">
          ğŸšš <span class="chip-text">{% if c.last_move[0] %}{{ c.last_move[0] }}{% else %}â€“{% endif %}</span>
        </span>
      </div>
    </a>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-muted">Keine MobilstÃ¤lle gefunden.</div>
  {% endif %}

  <div class="fm-actions">
    <a href="{{ url_for('huehner.menu') }}" class="btn btn-outline">â¬…ï¸ ZurÃ¼ck</a>
  </div>
</div>
{% endblock %}
